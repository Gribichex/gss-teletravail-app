(this["webpackJsonpgss-teletravail-app"]=this["webpackJsonpgss-teletravail-app"]||[]).push([[0],{147:function(e,t,n){e.exports={td:"tickDay_td__vs5zh"}},148:function(e,t,n){e.exports={td:"userSchedule_td__3AU4d"}},162:function(e,t,n){},230:function(e,t,n){"use strict";n.r(t);var a=n(4),s=n(0),c=n.n(s),r=n(40),i=n.n(r),o=(n(162),n(58)),l=n(156),u=n(34),d=n(132),j=n(86),h=(n(163),n(117)),b=function(e){return Object(a.jsxs)(d.a,{bg:"dark",variant:"dark",children:[Object(a.jsx)(h.LinkContainer,{to:"/",children:Object(a.jsx)(d.a.Brand,{children:"Thales"})}),Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsx)(h.LinkContainer,{to:"/",children:Object(a.jsx)(j.a.Link,{children:"Mon service"})}),Object(a.jsx)(h.LinkContainer,{to:"/login",children:e.loginStatus?Object(a.jsx)(j.a.Link,{children:"Logout"}):Object(a.jsx)(j.a.Link,{children:"Login"})})]})]})},m=n(13),O=n(60),f=n(84),x=n(150),p=n(53),g=n(18),v=n(144),y=n.n(v),S=n(154),w=(n(173),function(e){return Object(a.jsx)(y.a,{dateFormat:"MMMM yyyy",locale:S.a,selected:e.selected,onChange:function(t){e.handleChangeDate(t)},showMonthYearPicker:!0})}),C=n(83),k=n(94),N=n(95),D=n(155),A=n(149),I=n(147),L=n.n(I),T=function(e){return Object(a.jsx)("td",{className:L.a.td,onClick:function(){e.isClickable&&e.updateUser(e.user,e.selectedDate,e.indexJour,e.status)},style:function(){switch(e.status){case 0:return{background:"white"};case 1:return{background:"yellow"};case 2:return{background:"green"};case 3:return{background:"black"};default:return{background:"white"}}}()})},F=n(97),M=n(239),B=n(238),E=n(148),J=n.n(E),P=n(80),W=function(e){var t=function(e,t,n){var a=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,e+1));if(Object(B.a)(a))return 3;for(var s=0;s<n.length;s++)if(!Object(F.a)(a,Object(P.default)(n[s].date)))return n[s].status;return 0};return Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{className:J.a.td,children:[e.user.firstName," ",e.user.lastName]}),function(n,a){for(var c=[],r=n.nonWorkingDays,i=0;i<a.nbDays;i++)c.push(Object(s.createElement)(T,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:i,isClickable:3!==t(i,a,r)&&e.user.isActive,status:t(i,a,r)})));return c}(e.user,e.selectedDate)]})},G=n(98),z=function(e){var t=Object(s.useState)([]),n=Object(u.a)(t,2),c=n[0],r=n[1],i=localStorage.getItem("JWT"),o=Object(G.a)(i);Object(s.useEffect)((function(){fetch("/api/users/?department=GSS",{method:"GET",headers:{Authorization:"Bearer "+i}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){e.isActive=!1}));var t=e.findIndex((function(e){return o.email===e.email}));e[t].isActive=!0,e[t]=e.splice(0,1,e[t])[0],r(e)}),(function(e){console.log(e)}))}),[]);var l,d,j=function(e,t,n,a){var s=Object(D.a)(c),o=(a+1)%3,l=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,n+1)),u=c.findIndex((function(t){return t.email===e.email})),d=c[u].nonWorkingDays.findIndex((function(e){return 0===Object(F.a)(Object(P.default)(e.date),l)}));-1!==d?0!==o?s[u].nonWorkingDays[d]={date:l.toISOString(),status:o}:s[u].nonWorkingDays.splice(d,1):s[u].nonWorkingDays.push({date:l.toISOString(),status:o}),fetch("/api/users/"+s[u].email,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({nonWorkingDays:s[u].nonWorkingDays})}).catch((function(e){console.log(e)})),r((function(e){return s}))};return Object(a.jsxs)(A.a,{bordered:!0,hover:!0,responsive:!0,size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:function(e){for(var t=[Object(a.jsx)("th",{children:"Jour du Mois"},Object(M.a)())],n=0;n<e;n++)t.push(Object(a.jsx)("th",{children:n+1},Object(M.a)()));return t}(e.selectedDate.nbDays)})}),Object(a.jsx)("tbody",{children:(l=c,d=e.selectedDate,l.map((function(e,t){return Object(a.jsx)(W,{user:e,selectedDate:d,updateUser:j},t)})))})]})},U=function(e){var t=new Date,n=Object(s.useState)({indexOfMonth:Object(k.default)(t),indexOfYear:Object(N.default)(t),nbDays:Object(C.a)(t)}),c=Object(u.a)(n,2),r=c[0],i=c[1];return Object(a.jsxs)(f.a,{fluid:!0,className:"mt-5",children:[Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(w,{handleChangeDate:function(e){i({indexOfMonth:Object(k.default)(e),indexOfYear:Object(N.default)(e),nbDays:Object(C.a)(e)})},selected:new Date(Date.UTC(r.indexOfYear,r.indexOfMonth))},Object(M.a)())})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(z,{selectedDate:r})})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(x.a,{fluid:!0,children:Object(a.jsx)(f.a,{children:Object(a.jsxs)(p.a,{children:[Object(a.jsx)(g.a,{children:Object(a.jsxs)("h1",{children:[" ","Planning GSS"," ",new Date(r.indexOfYear,r.indexOfMonth).toLocaleDateString("fr-FR",{year:"numeric",month:"long"})]})}),Object(a.jsx)(g.a,{children:"L\xe9gende"})]})})})})})]})},R=n(9),Y=n(106),q=n(133),_=n(39);var V=function(e){var t=Object(m.k)(),n=Object(s.useState)(!1),c=Object(u.a)(n,2),r=c[0],i=c[1],o=_.a({fName:_.c().when("$isRegistered",{is:!0,then:_.c().required("obligatoire")}),lName:_.c().when("$isRegistered",{is:!0,then:_.c().required("obligatoire")}),email:_.c().email("Entrez une adresse valide").required("Une adresse mail est requise"),password:_.c().required("Champs obligatoire").min(8,"Au moins 8 caract\xe8res").matches(/[a-z]/,"Au moins une minuscule").matches(/[A-Z]/,"Au moins une majuscule").matches(/[a-zA-Z]+[^a-zA-Z\s]+/,"Au moins un chiffre ou caract\xe8re sp\xe9cial"),passwordConfirm:_.c().oneOf([_.b("password"),null],"Les mots de passe doivent \xeatre identiques")}),l=function(){var e=Object(q.b)().values;return Object(s.useEffect)((function(){""!==e.email&&fetch("/api/users/status/"+e.email).then((function(e){return e.json()})).then((function(e){void 0!==e&&i(e.userExist)}),(function(e){console.log(e)}))})),null};return Object(a.jsx)(f.a,{className:"my-5",children:Object(a.jsx)(q.a,{validationSchema:o,onSubmit:function(n,a){r?function(t){return new Promise((function(n,a){fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Mauvais mot de passe"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){a.setFieldError("password",e.message),a.setSubmitting(!1)})):function(t){return new Promise((function(n,a){fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t.fName,lastName:t.lName,email:t.email,department:"GSS",password:t.password,nonWorkingDays:[]})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Probl\xe8me lors de l'enregistrement du nouvel utilisateur"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){alert(e.message),a.setSubmitting(!1)}))},initialValues:{fName:"",lName:"",email:"",password:"",passwordConfirm:""},children:function(e){var t=e.handleSubmit,n=e.handleChange,s=e.handleBlur,c=e.touched,i=e.values,o=e.isValid,u=e.errors;return Object(a.jsxs)(R.a,{noValidate:!0,onSubmit:t,children:[Object(a.jsxs)("h1",{className:"mt-5",children:["Bonjour ",i.fName," ",i.lName]}),Object(a.jsx)("p",{className:"my-3",children:i.email}),Object(a.jsx)(R.a.Row,{children:Object(a.jsxs)(R.a.Group,{as:g.a,controlId:"validationFormikUsermail",children:[Object(a.jsx)(R.a.Label,{children:"Adresse mail"}),Object(a.jsx)(R.a.Control,{type:"text",placeholder:"Adresse mail","aria-describedby":"Adresse mail",name:"email",value:i.email,onChange:n,onBlur:s,isInvalid:c.email&&u.email}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:u.email})]})}),r?null:Object(a.jsxs)(R.a.Row,{children:[Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikFname",children:[Object(a.jsx)(R.a.Label,{children:"Pr\xe9nom"}),Object(a.jsx)(R.a.Control,{type:"text",name:"fName",value:i.fName,onChange:n,onBlur:s,isInvalid:c.fName&&u.fName}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:u.fName})]}),Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikLname",children:[Object(a.jsx)(R.a.Label,{children:"Nom"}),Object(a.jsx)(R.a.Control,{type:"text",name:"lName",value:i.lName,onChange:n,onBlur:s,isInvalid:c.lName&&u.lName}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:u.lName})]})]}),Object(a.jsxs)(R.a.Row,{children:[Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikPassword",children:[Object(a.jsx)(R.a.Label,{children:"Mot de passe"}),Object(a.jsx)(R.a.Control,{type:"password",name:"password",value:i.password,onChange:n,onBlur:s,isInvalid:c.password&&u.password}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:u.password})]}),r?null:Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikPasswordConfirm",children:[Object(a.jsx)(R.a.Label,{children:"Confirmation du mot de passe"}),Object(a.jsx)(R.a.Control,{type:"password",name:"passwordConfirm",value:i.passwordConfirm,onChange:n,onBlur:s,isInvalid:c.passwordConfirm&&u.passwordConfirm}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:u.passwordConfirm})]})]}),console.log(u),Object(a.jsx)(Y.a,{type:"submit",variant:"primary",disabled:!o,children:r?"Login":"Inscription"}),Object(a.jsx)(l,{})]})}})})};var Z=function(e){var t=Object(m.k)(),n=Object(s.useState)({}),c=Object(u.a)(n,2),r=c[0],i=c[1],o=localStorage.getItem("JWT"),l=Object(G.a)(o);return Object(s.useEffect)((function(){fetch("/api/users/"+l.email,{method:"GET",headers:{Authorization:"Bearer "+o}}).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(e){console.log(e)}))}),[]),Object(a.jsx)("div",{children:Object(a.jsxs)(f.a,{className:"my-5",children:[Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsxs)("h1",{className:"my-5",children:["Vous \xeates logg\xe9 comme ",r.firstName," ",r.lastName," (",r.email,")"]})})}),Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsx)(R.a,{onSubmit:function(n){localStorage.removeItem("JWT"),e.changeAuthStatus(!1),t.push("/login"),n.preventDefault()},children:Object(a.jsx)(Y.a,{className:"my-5",variant:"primary",type:"submit",children:"Logout"})})})})]})})};var $=function(e){return Object(a.jsx)("div",{children:e.currentAuth?Object(a.jsx)(Z,{changeAuthStatus:e.changeAuthStatus}):Object(a.jsx)(V,{changeAuthStatus:e.changeAuthStatus})})};var H=function(){var e=Object(s.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],r=function(e){var t=e.component,s=Object(l.a)(e,["component"]);return Object(a.jsx)(m.d,Object(o.a)(Object(o.a)({},s),{},{render:function(e){return n?Object(a.jsx)(t,Object(o.a)({},e)):Object(a.jsx)(m.c,{to:"/login"})}}))};return Object(a.jsx)("div",{children:Object(a.jsxs)(O.BrowserRouter,{children:[Object(a.jsx)(b,{loginStatus:n}),Object(a.jsxs)(m.g,{children:[Object(a.jsx)(m.d,{exact:!0,path:"/login",children:Object(a.jsx)($,{changeAuthStatus:function(e){c(e)},currentAuth:n})}),Object(a.jsx)(r,{exact:!0,path:"/",component:U})]})]})})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,240)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),s(e),c(e),r(e)}))};i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(H,{})}),document.getElementById("root")),K()}},[[230,1,2]]]);
//# sourceMappingURL=main.50f901ca.chunk.js.map