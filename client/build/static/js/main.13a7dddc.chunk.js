(this["webpackJsonpgss-teletravail-app"]=this["webpackJsonpgss-teletravail-app"]||[]).push([[0],{130:function(e,t,n){e.exports={navbar:"header_navbar__2Md7_",img:"header_img__1TnZd"}},133:function(e,t,n){e.exports={th:"HomeArray_th__1atYp"}},149:function(e,t,n){e.exports={td:"tickDay_td__vs5zh"}},150:function(e,t,n){e.exports={td:"userSchedule_td__3AU4d"}},156:function(e,t,n){e.exports={global:"global_global__1qDBh"}},165:function(e,t,n){},233:function(e,t,n){"use strict";n.r(t);var a=n(4),c=n(0),s=n.n(c),r=n(41),i=n.n(r),o=(n(165),n(19)),l=n(159),d=n(35),u=n(134),j=n(86),b=(n(166),n(117)),h=n(130),m=n.n(h),O=n.p+"static/media/logo.86b700a3.webp",f=function(e){return Object(a.jsxs)(u.a,{className:m.a.navbar,variant:"dark",children:[Object(a.jsx)(b.LinkContainer,{to:"/",children:Object(a.jsx)(u.a.Brand,{children:Object(a.jsx)("img",{className:m.a.img,src:O,alt:"logo"})})}),Object(a.jsxs)(j.a,{className:"ml-auto",children:[Object(a.jsx)(b.LinkContainer,{to:"/",children:Object(a.jsx)(j.a.Link,{className:"mx-3",children:"Mon service"})}),Object(a.jsx)(b.LinkContainer,{to:"/login",children:e.loginStatus?Object(a.jsx)(j.a.Link,{className:"mx-3",children:"Logout"}):Object(a.jsx)(j.a.Link,{className:"mx-3",children:"Login"})})]})]})},x=n(13),g=n(60),p=n(84),v=n(152),y=n(54),k=n(17),C=n(146),S=n.n(C),N=n(157),w=(n(176),function(e){return Object(a.jsx)(S.a,{dateFormat:"MMMM yyyy",locale:N.a,selected:e.selected,onChange:function(t){e.handleChangeDate(t)},showMonthYearPicker:!0})}),D=n(83),A=n(94),I=n(95),L=n(158),J=n(151),T=n(149),_=n.n(T),F=function(e){return Object(a.jsx)("td",{className:_.a.td,onClick:function(){e.isClickable&&e.updateUser(e.user,e.selectedDate,e.indexJour,e.status)},style:function(){switch(e.status){case 0:return{background:"white"};case 1:return{background:"yellow"};case 2:return{background:"rgb(93,191,212"};case 3:return{background:"black"};default:return{background:"white"}}}()})},E=n(97),M=n(242),B=n(241),W=n(150),P=n.n(W),G=n(80),z=function(e){var t=function(e,t,n){var a=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,e+1));if(Object(B.a)(a))return 3;for(var c=0;c<n.length;c++)if(!Object(E.a)(a,Object(G.default)(n[c].date)))return n[c].status;return 0};return Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{className:P.a.td,children:[e.user.firstName," ",e.user.lastName]}),function(n,a){for(var s=[],r=n.nonWorkingDays,i=0;i<a.nbDays;i++)s.push(Object(c.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:i,isClickable:3!==t(i,a,r)&&e.user.isActive,status:t(i,a,r)})));return s}(e.user,e.selectedDate)]})},U=n(98),Y=n(133),q=n.n(Y),R=function(e){var t=Object(c.useState)([]),n=Object(d.a)(t,2),s=n[0],r=n[1],i=localStorage.getItem("JWT"),o=Object(U.a)(i);Object(c.useEffect)((function(){fetch("/api/users/?department=GSS",{method:"GET",headers:{Authorization:"Bearer "+i}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){e.isActive=!1}));var t=e.findIndex((function(e){return o.email===e.email}));e[t].isActive=!0,e[t]=e.splice(0,1,e[t])[0],r(e)}),(function(e){console.log(e)}))}),[]);var l,u,j=function(e,t,n,a){var c=Object(L.a)(s),o=(a+1)%3,l=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,n+1)),d=s.findIndex((function(t){return t.email===e.email})),u=s[d].nonWorkingDays.findIndex((function(e){return 0===Object(E.a)(Object(G.default)(e.date),l)}));-1!==u?0!==o?c[d].nonWorkingDays[u]={date:l.toISOString(),status:o}:c[d].nonWorkingDays.splice(u,1):c[d].nonWorkingDays.push({date:l.toISOString(),status:o}),fetch("/api/users/"+c[d].email,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({nonWorkingDays:c[d].nonWorkingDays})}).catch((function(e){console.log(e)})),r((function(e){return c}))};return Object(a.jsxs)(J.a,{bordered:!0,hover:!0,responsive:!0,size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:function(e){for(var t=[Object(a.jsx)("th",{className:q.a.th,children:"Jour du Mois"},Object(M.a)())],n=0;n<e;n++)t.push(Object(a.jsx)("th",{className:q.a.th,children:(n+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})},Object(M.a)()));return t}(e.selectedDate.nbDays)})}),Object(a.jsx)("tbody",{children:(l=s,u=e.selectedDate,l.map((function(e,t){return Object(a.jsx)(z,{user:e,selectedDate:u,updateUser:j},t)})))})]})},V=function(e){var t=new Date,n=Object(c.useState)({indexOfMonth:Object(A.default)(t),indexOfYear:Object(I.default)(t),nbDays:Object(D.a)(t)}),s=Object(d.a)(n,2),r=s[0],i=s[1];return Object(a.jsxs)(p.a,{fluid:!0,className:"mt-5",children:[Object(a.jsx)(y.a,{className:"my-5",children:Object(a.jsx)(k.a,{children:Object(a.jsx)(w,{handleChangeDate:function(e){i({indexOfMonth:Object(A.default)(e),indexOfYear:Object(I.default)(e),nbDays:Object(D.a)(e)})},selected:new Date(Date.UTC(r.indexOfYear,r.indexOfMonth))},Object(M.a)())})}),Object(a.jsx)(y.a,{className:"my-5",children:Object(a.jsx)(k.a,{children:Object(a.jsx)(R,{selectedDate:r})})}),Object(a.jsx)(y.a,{className:"my-5",children:Object(a.jsx)(k.a,{children:Object(a.jsx)(v.a,{fluid:!0,children:Object(a.jsx)(p.a,{children:Object(a.jsxs)(y.a,{children:[Object(a.jsx)(k.a,{md:!0,children:Object(a.jsxs)("h1",{children:[" ","Planning GSS"," ",new Date(r.indexOfYear,r.indexOfMonth).toLocaleDateString("fr-FR",{year:"numeric",month:"long"})]})}),Object(a.jsx)(k.a,{md:!0}),Object(a.jsx)(k.a,{md:!0,children:Object(a.jsx)("table",{children:Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour sur site"}),Object(c.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:0,isClickable:!1,status:0}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour en t\xe9l\xe9travail"}),Object(c.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:1,isClickable:!1,status:1}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour de cong\xe9"}),Object(c.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:0,isClickable:!1,status:2}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Week-end"}),Object(c.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:0,isClickable:!1,status:3}))]})]})})})]})})})})})]})},Z=n(9),H=n(106),$=n(135),K=n(40);var Q=function(e){var t=Object(x.k)(),n=Object(c.useState)(!1),s=Object(d.a)(n,2),r=s[0],i=s[1],o=K.a({fName:K.c().when("$isRegistered",{is:!0,then:K.c().required("obligatoire")}),lName:K.c().when("$isRegistered",{is:!0,then:K.c().required("obligatoire")}),email:K.c().email("Entrez une adresse valide").required("Une adresse mail est requise"),password:K.c().required("Champs obligatoire").min(8,"Au moins 8 caract\xe8res").matches(/[a-z]/,"Au moins une minuscule").matches(/[A-Z]/,"Au moins une majuscule").matches(/[a-zA-Z]+[^a-zA-Z\s]+/,"Au moins un chiffre ou caract\xe8re sp\xe9cial"),passwordConfirm:K.c().oneOf([K.b("password"),null],"Les mots de passe doivent \xeatre identiques")}),l=function(){var e=Object($.b)().values;return Object(c.useEffect)((function(){""!==e.email&&fetch("/api/users/status/"+e.email).then((function(e){return e.json()})).then((function(e){void 0!==e&&i(e.userExist)}),(function(e){console.log(e)}))})),null};return Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)($.a,{validationSchema:o,onSubmit:function(n,a){r?function(t){return new Promise((function(n,a){fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Mauvais mot de passe"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){a.setFieldError("password",e.message),a.setSubmitting(!1)})):function(t){return new Promise((function(n,a){fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t.fName,lastName:t.lName,email:t.email,department:"GSS",password:t.password,nonWorkingDays:[]})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Probl\xe8me lors de l'enregistrement du nouvel utilisateur"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){alert(e.message),a.setSubmitting(!1)}))},initialValues:{fName:"",lName:"",email:"",password:"",passwordConfirm:""},children:function(e){var t=e.handleSubmit,n=e.handleChange,c=e.handleBlur,s=e.touched,i=e.values,o=e.isValid,d=e.errors;return Object(a.jsxs)(Z.a,{noValidate:!0,onSubmit:t,children:[Object(a.jsxs)("h1",{className:"mt-5",children:["Bonjour ",i.fName," ",i.lName]}),Object(a.jsx)("p",{className:"my-3",children:i.email}),Object(a.jsx)(Z.a.Row,{children:Object(a.jsxs)(Z.a.Group,{as:k.a,controlId:"validationFormikUsermail",children:[Object(a.jsx)(Z.a.Label,{children:"Adresse mail"}),Object(a.jsx)(Z.a.Control,{type:"text",placeholder:"Adresse mail","aria-describedby":"Adresse mail",name:"email",value:i.email,onChange:n,onBlur:c,isInvalid:s.email&&d.email}),Object(a.jsx)(Z.a.Control.Feedback,{type:"invalid",children:d.email})]})}),r?null:Object(a.jsxs)(Z.a.Row,{children:[Object(a.jsxs)(Z.a.Group,{as:k.a,md:"6",controlId:"validationFormikFname",children:[Object(a.jsx)(Z.a.Label,{children:"Pr\xe9nom"}),Object(a.jsx)(Z.a.Control,{type:"text",name:"fName",value:i.fName,onChange:n,onBlur:c,isInvalid:s.fName&&d.fName}),Object(a.jsx)(Z.a.Control.Feedback,{type:"invalid",children:d.fName})]}),Object(a.jsxs)(Z.a.Group,{as:k.a,md:"6",controlId:"validationFormikLname",children:[Object(a.jsx)(Z.a.Label,{children:"Nom"}),Object(a.jsx)(Z.a.Control,{type:"text",name:"lName",value:i.lName,onChange:n,onBlur:c,isInvalid:s.lName&&d.lName}),Object(a.jsx)(Z.a.Control.Feedback,{type:"invalid",children:d.lName})]})]}),Object(a.jsxs)(Z.a.Row,{children:[Object(a.jsxs)(Z.a.Group,{as:k.a,md:"6",controlId:"validationFormikPassword",children:[Object(a.jsx)(Z.a.Label,{children:"Mot de passe"}),Object(a.jsx)(Z.a.Control,{type:"password",name:"password",value:i.password,onChange:n,onBlur:c,isInvalid:s.password&&d.password}),Object(a.jsx)(Z.a.Control.Feedback,{type:"invalid",children:d.password})]}),r?null:Object(a.jsxs)(Z.a.Group,{as:k.a,md:"6",controlId:"validationFormikPasswordConfirm",children:[Object(a.jsx)(Z.a.Label,{children:"Confirmation du mot de passe"}),Object(a.jsx)(Z.a.Control,{type:"password",name:"passwordConfirm",value:i.passwordConfirm,onChange:n,onBlur:c,isInvalid:s.passwordConfirm&&d.passwordConfirm}),Object(a.jsx)(Z.a.Control.Feedback,{type:"invalid",children:d.passwordConfirm})]})]}),Object(a.jsx)(H.a,{type:"submit",variant:"primary",style:{backgroundColor:"rgb(36,42,117)"},disabled:!o,children:r?"Login":"Inscription"}),Object(a.jsx)(l,{})]})}})})};var X=function(e){var t=Object(x.k)(),n=Object(c.useState)({}),s=Object(d.a)(n,2),r=s[0],i=s[1],o=localStorage.getItem("JWT"),l=Object(U.a)(o);return Object(c.useEffect)((function(){fetch("/api/users/"+l.email,{method:"GET",headers:{Authorization:"Bearer "+o}}).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(e){console.log(e)}))}),[]),Object(a.jsx)("div",{children:Object(a.jsxs)(p.a,{className:"my-5",children:[Object(a.jsx)(y.a,{children:Object(a.jsx)(k.a,{children:Object(a.jsxs)("h1",{className:"my-5",children:["Vous \xeates logg\xe9 comme ",r.firstName," ",r.lastName," (",r.email,")"]})})}),Object(a.jsx)(y.a,{children:Object(a.jsx)(k.a,{children:Object(a.jsx)(Z.a,{onSubmit:function(n){localStorage.removeItem("JWT"),e.changeAuthStatus(!1),t.push("/login"),n.preventDefault()},children:Object(a.jsx)(H.a,{className:"my-5",variant:"primary",style:{backgroundColor:"rgb(36,42,117)"},type:"submit",children:"Logout"})})})})]})})};var ee=function(e){return Object(a.jsx)("div",{children:e.currentAuth?Object(a.jsx)(X,{changeAuthStatus:e.changeAuthStatus}):Object(a.jsx)(Q,{changeAuthStatus:e.changeAuthStatus})})},te=n(156),ne=n.n(te);var ae=function(){var e=Object(c.useState)(!1),t=Object(d.a)(e,2),n=t[0],s=t[1],r=function(e){var t=e.component,c=Object(l.a)(e,["component"]);return Object(a.jsx)(x.d,Object(o.a)(Object(o.a)({},c),{},{render:function(e){return n?Object(a.jsx)(t,Object(o.a)({},e)):Object(a.jsx)(x.c,{to:"/login"})}}))};return Object(a.jsx)("div",{className:ne.a.global,children:Object(a.jsxs)(g.BrowserRouter,{children:[Object(a.jsx)(f,{loginStatus:n}),Object(a.jsxs)(x.g,{children:[Object(a.jsx)(x.d,{exact:!0,path:"/login",children:Object(a.jsx)(ee,{changeAuthStatus:function(e){s(e)},currentAuth:n})}),Object(a.jsx)(r,{exact:!0,path:"/",component:V})]})]})})},ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,243)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};i.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(ae,{})}),document.getElementById("root")),ce()}},[[233,1,2]]]);
//# sourceMappingURL=main.13a7dddc.chunk.js.map