(this["webpackJsonpgss-teletravail-app"]=this["webpackJsonpgss-teletravail-app"]||[]).push([[0],{147:function(e,t,n){e.exports={td:"tickDay_td__vs5zh"}},148:function(e,t,n){e.exports={td:"userSchedule_td__3AU4d"}},162:function(e,t,n){},230:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(0),c=n.n(r),s=n(39),i=n.n(s),o=(n(162),n(58)),l=n(156),u=n(25),d=n(132),j=n(86),h=(n(163),n(117)),b=function(e){return Object(a.jsxs)(d.a,{bg:"dark",variant:"dark",children:[Object(a.jsx)(h.LinkContainer,{to:"/",children:Object(a.jsx)(d.a.Brand,{children:"Thales"})}),Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsx)(h.LinkContainer,{to:"/",children:Object(a.jsx)(j.a.Link,{children:"Mon service"})}),Object(a.jsx)(h.LinkContainer,{to:"/login",children:e.loginStatus?Object(a.jsx)(j.a.Link,{children:"Logout"}):Object(a.jsx)(j.a.Link,{children:"Login"})})]})]})},m=n(13),O=n(60),f=n(84),x=n(150),p=n(57),g=n(19),v=n(144),y=n.n(v),S=n(154),C=(n(173),function(e){var t=Object(r.useState)(new Date),n=Object(u.a)(t,2),c=n[0],s=n[1];return Object(a.jsx)(y.a,{dateFormat:"MMMM yyyy",locale:S.a,selected:c,onChange:function(t){e.handleChangeDate(t),s(t)},showMonthYearPicker:!0})}),k=n(83),w=n(94),N=n(95),D=n(155),A=n(149),I=n(147),L=n.n(I),F=function(e){return Object(a.jsx)("td",{className:L.a.td,onClick:function(){e.isClickable&&e.updateUser(e.user,e.selectedDate,e.indexJour,e.status)},style:function(){switch(e.status){case 0:return{background:"white"};case 1:return{background:"yellow"};case 2:return{background:"green"};case 3:return{background:"black"};default:return{background:"white"}}}()})},T=n(97),M=n(239),B=n(238),E=n(148),J=n.n(E),P=n(80),W=function(e){var t=function(e,t,n){var a=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,e+1));if(Object(B.a)(a))return 3;for(var r=0;r<n.length;r++)if(!Object(T.a)(a,Object(P.default)(n[r].date)))return n[r].status;return 0};return Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{className:J.a.td,children:[e.user.firstName," ",e.user.lastName]}),function(n,a){for(var c=[],s=n.nonWorkingDays,i=0;i<a.nbDays;i++)c.push(Object(r.createElement)(F,Object(o.a)(Object(o.a)({},e),{},{key:Object(M.a)(),indexJour:i,isClickable:3!==t(i,a,s)&&e.user.isActive,status:t(i,a,s)})));return c}(e.user,e.selectedDate)]})},G=n(98),z=function(e){var t=Object(r.useState)([]),n=Object(u.a)(t,2),c=n[0],s=n[1],i=localStorage.getItem("JWT"),o=Object(G.a)(i);Object(r.useEffect)((function(){fetch("/api/users/?department=GSS",{method:"GET",headers:{Authorization:"Bearer "+i}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){e.isActive=!1}));var t=e.findIndex((function(e){return o.email===e.email}));e[t].isActive=!0,e[t]=e.splice(0,1,e[t])[0],s(e)}),(function(e){console.log(e)}))}),[]);var l,d,j=function(e,t,n,a){var r=Object(D.a)(c),o=(a+1)%3,l=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,n+1)),u=c.findIndex((function(t){return t.email===e.email})),d=c[u].nonWorkingDays.findIndex((function(e){return 0===Object(T.a)(Object(P.default)(e.date),l)}));-1!==d?0!==o?r[u].nonWorkingDays[d]={date:l.toISOString(),status:o}:r[u].nonWorkingDays.splice(d,1):r[u].nonWorkingDays.push({date:l.toISOString(),status:o}),fetch("/api/users/"+r[u].email,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({nonWorkingDays:r[u].nonWorkingDays})}).catch((function(e){console.log(e)})),s((function(e){return r}))};return Object(a.jsxs)(A.a,{bordered:!0,hover:!0,responsive:!0,size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:function(e){for(var t=[Object(a.jsx)("th",{children:"Jour du Mois"},Object(M.a)())],n=0;n<e;n++)t.push(Object(a.jsx)("th",{children:n+1},Object(M.a)()));return t}(e.selectedDate.nbDays)})}),Object(a.jsx)("tbody",{children:(l=c,d=e.selectedDate,l.map((function(e,t){return Object(a.jsx)(W,{user:e,selectedDate:d,updateUser:j},t)})))})]})},U=function(e){var t=new Date;console.log("coucou");var n=Object(r.useState)({indexOfMonth:Object(w.default)(t),indexOfYear:Object(N.default)(t),nbDays:Object(k.a)(t)}),c=Object(u.a)(n,2),s=c[0],i=c[1];return Object(a.jsxs)(f.a,{fluid:!0,className:"mt-5",children:[Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(C,{handleChangeDate:function(e){i({indexOfMonth:Object(w.default)(e),indexOfYear:Object(N.default)(e),nbDays:Object(k.a)(e)})}},Object(M.a)())})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(z,{selectedDate:s})})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(x.a,{fluid:!0,children:Object(a.jsx)(f.a,{children:Object(a.jsxs)("h1",{children:[" ","Planning GSS"," ",new Date(s.indexOfYear,s.indexOfMonth).toLocaleDateString("fr-FR",{year:"numeric",month:"long"})]})})})})})]})},q=n(9),Y=n(106),_=n(133),R=n(52);var V=function(e){var t=Object(m.k)(),n=R.a({fName:R.c().required("Champs obligatoire"),lName:R.c().required("Champs obligatoire"),email:R.c().email("Entrez une adresse valide").required("Une adresse mail est requise"),password:R.c().required("Champs obligatoire").min(8,"Au moins 8 caract\xe8res").matches(/[a-z]/,"Au moins une minuscule").matches(/[A-Z]/,"Au moins une majuscule").matches(/[a-zA-Z]+[^a-zA-Z\s]+/,"Au moins un chiffre ou caract\xe8re sp\xe9cial"),passwordConfirm:R.c().oneOf([R.b("password"),null],"Les mots de passe doivent \xeatre identiques")}),c=Object(r.useState)(!1),s=Object(u.a)(c,2),i=s[0],o=s[1],l=function(){var e=Object(_.b)().values;return Object(r.useEffect)((function(){""!==e.email&&fetch("/api/users/status/"+e.email).then((function(e){return e.json()})).then((function(e){void 0!==e&&o(e.userExist)}),(function(e){console.log(e)}))})),null};return Object(a.jsx)(f.a,{className:"my-5",children:Object(a.jsx)(_.a,{validationSchema:n,onSubmit:function(n,a){i?function(t){return new Promise((function(n,a){fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Mauvais mot de passe"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){a.setFieldError("password",e.message),a.setSubmitting(!1)})):function(t){return new Promise((function(n,a){fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t.fName,lastName:t.lName,email:t.email,department:"GSS",password:t.password,nonWorkingDays:[]})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Probl\xe8me lors de l'enregistrement du nouvel utilisateur"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){alert(e.message),a.setSubmitting(!1)}))},initialValues:{fName:"",lName:"",email:"",password:"",passwordConfirm:""},children:function(e){var t=e.handleSubmit,n=e.handleChange,r=e.handleBlur,c=e.touched,s=e.values,o=e.isValid,u=e.errors;return Object(a.jsxs)(q.a,{noValidate:!0,onSubmit:t,children:[Object(a.jsxs)("h1",{className:"mt-5",children:["Bonjour ",s.fName," ",s.lName]}),Object(a.jsx)("p",{className:"my-3",children:s.email}),Object(a.jsx)(q.a.Row,{children:Object(a.jsxs)(q.a.Group,{as:g.a,controlId:"validationFormikUsermail",children:[Object(a.jsx)(q.a.Label,{children:"Adresse mail"}),Object(a.jsx)(q.a.Control,{type:"text",placeholder:"Adresse mail","aria-describedby":"Adresse mail",name:"email",value:s.email,onChange:n,onBlur:r,isInvalid:c.email&&u.email}),Object(a.jsx)(q.a.Control.Feedback,{type:"invalid",children:u.email})]})}),i?null:Object(a.jsxs)(q.a.Row,{children:[Object(a.jsxs)(q.a.Group,{as:g.a,md:"6",controlId:"validationFormikFname",children:[Object(a.jsx)(q.a.Label,{children:"Pr\xe9nom"}),Object(a.jsx)(q.a.Control,{type:"text",name:"fName",value:s.fName,onChange:n,onBlur:r,isInvalid:c.fName&&u.fName}),Object(a.jsx)(q.a.Control.Feedback,{type:"invalid",children:u.fName})]}),Object(a.jsxs)(q.a.Group,{as:g.a,md:"6",controlId:"validationFormikLname",children:[Object(a.jsx)(q.a.Label,{children:"Nom"}),Object(a.jsx)(q.a.Control,{type:"text",name:"lName",value:s.lName,onChange:n,onBlur:r,isInvalid:c.lName&&u.lName}),Object(a.jsx)(q.a.Control.Feedback,{type:"invalid",children:u.lName})]})]}),Object(a.jsxs)(q.a.Row,{children:[Object(a.jsxs)(q.a.Group,{as:g.a,md:"6",controlId:"validationFormikPassword",children:[Object(a.jsx)(q.a.Label,{children:"Mot de passe"}),Object(a.jsx)(q.a.Control,{type:"password",name:"password",value:s.password,onChange:n,onBlur:r,isInvalid:c.password&&u.password}),Object(a.jsx)(q.a.Control.Feedback,{type:"invalid",children:u.password})]}),i?null:Object(a.jsxs)(q.a.Group,{as:g.a,md:"6",controlId:"validationFormikPasswordConfirm",children:[Object(a.jsx)(q.a.Label,{children:"Confirmation du mot de passe"}),Object(a.jsx)(q.a.Control,{type:"password",name:"passwordConfirm",value:s.passwordConfirm,onChange:n,onBlur:r,isInvalid:c.passwordConfirm&&u.passwordConfirm}),Object(a.jsx)(q.a.Control.Feedback,{type:"invalid",children:u.passwordConfirm})]})]}),Object(a.jsx)(Y.a,{type:"submit",variant:"primary",disabled:!o,children:i?"Login":"Inscription"}),Object(a.jsx)(l,{})]})}})})};var Z=function(e){var t=Object(m.k)(),n=Object(r.useState)({}),c=Object(u.a)(n,2),s=c[0],i=c[1],o=localStorage.getItem("JWT"),l=Object(G.a)(o);return Object(r.useEffect)((function(){fetch("/api/users/"+l.email,{method:"GET",headers:{Authorization:"Bearer "+o}}).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(e){console.log(e)}))}),[]),Object(a.jsx)("div",{children:Object(a.jsxs)(f.a,{className:"my-5",children:[Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsxs)("h1",{className:"my-5",children:["Vous \xeates logg\xe9 comme ",s.firstName," ",s.lastName," (",s.email,")"]})})}),Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsx)(q.a,{onSubmit:function(n){localStorage.removeItem("JWT"),e.changeAuthStatus(!1),t.push("/login"),n.preventDefault()},children:Object(a.jsx)(Y.a,{className:"my-5",variant:"primary",type:"submit",children:"Logout"})})})})]})})};var H=function(e){return Object(a.jsx)("div",{children:e.currentAuth?Object(a.jsx)(Z,{changeAuthStatus:e.changeAuthStatus}):Object(a.jsx)(V,{changeAuthStatus:e.changeAuthStatus})})};var K=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],s=function(e){var t=e.component,r=Object(l.a)(e,["component"]);return Object(a.jsx)(m.d,Object(o.a)(Object(o.a)({},r),{},{render:function(e){return n?Object(a.jsx)(t,Object(o.a)({},e)):Object(a.jsx)(m.c,{to:"/login"})}}))};return Object(a.jsx)("div",{children:Object(a.jsxs)(O.BrowserRouter,{children:[Object(a.jsx)(b,{loginStatus:n}),Object(a.jsxs)(m.g,{children:[Object(a.jsx)(m.d,{exact:!0,path:"/login",children:Object(a.jsx)(H,{changeAuthStatus:function(e){c(e)},currentAuth:n})}),Object(a.jsx)(s,{exact:!0,path:"/",component:U})]})]})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,240)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(K,{})}),document.getElementById("root")),Q()}},[[230,1,2]]]);
//# sourceMappingURL=main.ba737929.chunk.js.map