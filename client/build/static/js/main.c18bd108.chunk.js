(this["webpackJsonpgss-teletravail-app"]=this["webpackJsonpgss-teletravail-app"]||[]).push([[0],{147:function(e,t,n){e.exports={td:"tickDay_td__vs5zh"}},148:function(e,t,n){e.exports={td:"userSchedule_td__3AU4d"}},162:function(e,t,n){},230:function(e,t,n){"use strict";n.r(t);var a=n(4),c=n(0),s=n.n(c),r=n(41),i=n.n(r),o=(n(162),n(19)),l=n(156),d=n(35),u=n(132),j=n(86),b=(n(163),n(117)),h=function(e){return Object(a.jsxs)(u.a,{bg:"dark",variant:"dark",children:[Object(a.jsx)(b.LinkContainer,{to:"/",children:Object(a.jsx)(u.a.Brand,{children:"Thales"})}),Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsx)(b.LinkContainer,{to:"/",children:Object(a.jsx)(j.a.Link,{children:"Mon service"})}),Object(a.jsx)(b.LinkContainer,{to:"/login",children:e.loginStatus?Object(a.jsx)(j.a.Link,{children:"Logout"}):Object(a.jsx)(j.a.Link,{children:"Login"})})]})]})},O=n(13),m=n(60),f=n(84),x=n(150),p=n(54),g=n(17),v=n(144),y=n.n(v),k=n(154),C=(n(173),function(e){return Object(a.jsx)(y.a,{dateFormat:"MMMM yyyy",locale:k.a,selected:e.selected,onChange:function(t){e.handleChangeDate(t)},showMonthYearPicker:!0})}),S=n(83),w=n(94),N=n(95),D=n(155),A=n(149),I=n(147),J=n.n(I),L=function(e){return Object(a.jsx)("td",{className:J.a.td,onClick:function(){e.isClickable&&e.updateUser(e.user,e.selectedDate,e.indexJour,e.status)},style:function(){switch(e.status){case 0:return{background:"white"};case 1:return{background:"yellow"};case 2:return{background:"green"};case 3:return{background:"black"};default:return{background:"white"}}}()})},T=n(97),F=n(239),E=n(238),M=n(148),B=n.n(M),W=n(80),P=function(e){var t=function(e,t,n){var a=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,e+1));if(Object(E.a)(a))return 3;for(var c=0;c<n.length;c++)if(!Object(T.a)(a,Object(W.default)(n[c].date)))return n[c].status;return 0};return Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{className:B.a.td,children:[e.user.firstName," ",e.user.lastName]}),function(n,a){for(var s=[],r=n.nonWorkingDays,i=0;i<a.nbDays;i++)s.push(Object(c.createElement)(L,Object(o.a)(Object(o.a)({},e),{},{key:Object(F.a)(),indexJour:i,isClickable:3!==t(i,a,r)&&e.user.isActive,status:t(i,a,r)})));return s}(e.user,e.selectedDate)]})},G=n(98),z=function(e){var t=Object(c.useState)([]),n=Object(d.a)(t,2),s=n[0],r=n[1],i=localStorage.getItem("JWT"),o=Object(G.a)(i);Object(c.useEffect)((function(){fetch("/api/users/?department=GSS",{method:"GET",headers:{Authorization:"Bearer "+i}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){e.isActive=!1}));var t=e.findIndex((function(e){return o.email===e.email}));e[t].isActive=!0,e[t]=e.splice(0,1,e[t])[0],r(e)}),(function(e){console.log(e)}))}),[]);var l,u,j=function(e,t,n,a){var c=Object(D.a)(s),o=(a+1)%3,l=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,n+1)),d=s.findIndex((function(t){return t.email===e.email})),u=s[d].nonWorkingDays.findIndex((function(e){return 0===Object(T.a)(Object(W.default)(e.date),l)}));-1!==u?0!==o?c[d].nonWorkingDays[u]={date:l.toISOString(),status:o}:c[d].nonWorkingDays.splice(u,1):c[d].nonWorkingDays.push({date:l.toISOString(),status:o}),fetch("/api/users/"+c[d].email,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({nonWorkingDays:c[d].nonWorkingDays})}).catch((function(e){console.log(e)})),r((function(e){return c}))};return Object(a.jsxs)(A.a,{bordered:!0,hover:!0,responsive:!0,size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:function(e){for(var t=[Object(a.jsx)("th",{children:"Jour du Mois"},Object(F.a)())],n=0;n<e;n++)t.push(Object(a.jsx)("th",{children:n+1},Object(F.a)()));return t}(e.selectedDate.nbDays)})}),Object(a.jsx)("tbody",{children:(l=s,u=e.selectedDate,l.map((function(e,t){return Object(a.jsx)(P,{user:e,selectedDate:u,updateUser:j},t)})))})]})},U=function(e){var t=new Date,n=Object(c.useState)({indexOfMonth:Object(w.default)(t),indexOfYear:Object(N.default)(t),nbDays:Object(S.a)(t)}),s=Object(d.a)(n,2),r=s[0],i=s[1];return Object(a.jsxs)(f.a,{fluid:!0,className:"mt-5",children:[Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(C,{handleChangeDate:function(e){i({indexOfMonth:Object(w.default)(e),indexOfYear:Object(N.default)(e),nbDays:Object(S.a)(e)})},selected:new Date(Date.UTC(r.indexOfYear,r.indexOfMonth))},Object(F.a)())})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(z,{selectedDate:r})})}),Object(a.jsx)(p.a,{className:"my-5",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(x.a,{fluid:!0,children:Object(a.jsx)(f.a,{children:Object(a.jsxs)(p.a,{children:[Object(a.jsx)(g.a,{children:Object(a.jsxs)("h1",{children:[" ","Planning GSS"," ",new Date(r.indexOfYear,r.indexOfMonth).toLocaleDateString("fr-FR",{year:"numeric",month:"long"})]})}),Object(a.jsx)(g.a,{}),Object(a.jsx)(g.a,{children:Object(a.jsx)("table",{children:Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour sur site"}),Object(c.createElement)(L,Object(o.a)(Object(o.a)({},e),{},{key:Object(F.a)(),indexJour:0,isClickable:!1,status:0}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour en t\xe9l\xe9travail"}),Object(c.createElement)(L,Object(o.a)(Object(o.a)({},e),{},{key:Object(F.a)(),indexJour:1,isClickable:!1,status:1}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour de cong\xe9"}),Object(c.createElement)(L,Object(o.a)(Object(o.a)({},e),{},{key:Object(F.a)(),indexJour:0,isClickable:!1,status:2}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Week-end"}),Object(c.createElement)(L,Object(o.a)(Object(o.a)({},e),{},{key:Object(F.a)(),indexJour:0,isClickable:!1,status:3}))]})]})})})]})})})})})]})},R=n(9),Y=n(106),q=n(133),_=n(40);var V=function(e){var t=Object(O.k)(),n=Object(c.useState)(!1),s=Object(d.a)(n,2),r=s[0],i=s[1],o=_.a({fName:_.c().when("$isRegistered",{is:!0,then:_.c().required("obligatoire")}),lName:_.c().when("$isRegistered",{is:!0,then:_.c().required("obligatoire")}),email:_.c().email("Entrez une adresse valide").required("Une adresse mail est requise"),password:_.c().required("Champs obligatoire").min(8,"Au moins 8 caract\xe8res").matches(/[a-z]/,"Au moins une minuscule").matches(/[A-Z]/,"Au moins une majuscule").matches(/[a-zA-Z]+[^a-zA-Z\s]+/,"Au moins un chiffre ou caract\xe8re sp\xe9cial"),passwordConfirm:_.c().oneOf([_.b("password"),null],"Les mots de passe doivent \xeatre identiques")}),l=function(){var e=Object(q.b)().values;return Object(c.useEffect)((function(){""!==e.email&&fetch("/api/users/status/"+e.email).then((function(e){return e.json()})).then((function(e){void 0!==e&&i(e.userExist)}),(function(e){console.log(e)}))})),null};return Object(a.jsx)(f.a,{className:"my-5",children:Object(a.jsx)(q.a,{validationSchema:o,onSubmit:function(n,a){r?function(t){return new Promise((function(n,a){fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Mauvais mot de passe"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){a.setFieldError("password",e.message),a.setSubmitting(!1)})):function(t){return new Promise((function(n,a){fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t.fName,lastName:t.lName,email:t.email,department:"GSS",password:t.password,nonWorkingDays:[]})}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("JWT",e.token)})).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Probl\xe8me lors de l'enregistrement du nouvel utilisateur"))}))}))}(n).then((function(){a.setSubmitting(!1),t.push("/")})).catch((function(e){alert(e.message),a.setSubmitting(!1)}))},initialValues:{fName:"",lName:"",email:"",password:"",passwordConfirm:""},children:function(e){var t=e.handleSubmit,n=e.handleChange,c=e.handleBlur,s=e.touched,i=e.values,o=e.isValid,d=e.errors;return Object(a.jsxs)(R.a,{noValidate:!0,onSubmit:t,children:[Object(a.jsxs)("h1",{className:"mt-5",children:["Bonjour ",i.fName," ",i.lName]}),Object(a.jsx)("p",{className:"my-3",children:i.email}),Object(a.jsx)(R.a.Row,{children:Object(a.jsxs)(R.a.Group,{as:g.a,controlId:"validationFormikUsermail",children:[Object(a.jsx)(R.a.Label,{children:"Adresse mail"}),Object(a.jsx)(R.a.Control,{type:"text",placeholder:"Adresse mail","aria-describedby":"Adresse mail",name:"email",value:i.email,onChange:n,onBlur:c,isInvalid:s.email&&d.email}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:d.email})]})}),r?null:Object(a.jsxs)(R.a.Row,{children:[Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikFname",children:[Object(a.jsx)(R.a.Label,{children:"Pr\xe9nom"}),Object(a.jsx)(R.a.Control,{type:"text",name:"fName",value:i.fName,onChange:n,onBlur:c,isInvalid:s.fName&&d.fName}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:d.fName})]}),Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikLname",children:[Object(a.jsx)(R.a.Label,{children:"Nom"}),Object(a.jsx)(R.a.Control,{type:"text",name:"lName",value:i.lName,onChange:n,onBlur:c,isInvalid:s.lName&&d.lName}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:d.lName})]})]}),Object(a.jsxs)(R.a.Row,{children:[Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikPassword",children:[Object(a.jsx)(R.a.Label,{children:"Mot de passe"}),Object(a.jsx)(R.a.Control,{type:"password",name:"password",value:i.password,onChange:n,onBlur:c,isInvalid:s.password&&d.password}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:d.password})]}),r?null:Object(a.jsxs)(R.a.Group,{as:g.a,md:"6",controlId:"validationFormikPasswordConfirm",children:[Object(a.jsx)(R.a.Label,{children:"Confirmation du mot de passe"}),Object(a.jsx)(R.a.Control,{type:"password",name:"passwordConfirm",value:i.passwordConfirm,onChange:n,onBlur:c,isInvalid:s.passwordConfirm&&d.passwordConfirm}),Object(a.jsx)(R.a.Control.Feedback,{type:"invalid",children:d.passwordConfirm})]})]}),Object(a.jsx)(Y.a,{type:"submit",variant:"primary",disabled:!o,children:r?"Login":"Inscription"}),Object(a.jsx)(l,{})]})}})})};var Z=function(e){var t=Object(O.k)(),n=Object(c.useState)({}),s=Object(d.a)(n,2),r=s[0],i=s[1],o=localStorage.getItem("JWT"),l=Object(G.a)(o);return Object(c.useEffect)((function(){fetch("/api/users/"+l.email,{method:"GET",headers:{Authorization:"Bearer "+o}}).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(e){console.log(e)}))}),[]),Object(a.jsx)("div",{children:Object(a.jsxs)(f.a,{className:"my-5",children:[Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsxs)("h1",{className:"my-5",children:["Vous \xeates logg\xe9 comme ",r.firstName," ",r.lastName," (",r.email,")"]})})}),Object(a.jsx)(p.a,{children:Object(a.jsx)(g.a,{children:Object(a.jsx)(R.a,{onSubmit:function(n){localStorage.removeItem("JWT"),e.changeAuthStatus(!1),t.push("/login"),n.preventDefault()},children:Object(a.jsx)(Y.a,{className:"my-5",variant:"primary",type:"submit",children:"Logout"})})})})]})})};var $=function(e){return Object(a.jsx)("div",{children:e.currentAuth?Object(a.jsx)(Z,{changeAuthStatus:e.changeAuthStatus}):Object(a.jsx)(V,{changeAuthStatus:e.changeAuthStatus})})};var H=function(){var e=Object(c.useState)(!1),t=Object(d.a)(e,2),n=t[0],s=t[1],r=function(e){var t=e.component,c=Object(l.a)(e,["component"]);return Object(a.jsx)(O.d,Object(o.a)(Object(o.a)({},c),{},{render:function(e){return n?Object(a.jsx)(t,Object(o.a)({},e)):Object(a.jsx)(O.c,{to:"/login"})}}))};return Object(a.jsx)("div",{children:Object(a.jsxs)(m.BrowserRouter,{children:[Object(a.jsx)(h,{loginStatus:n}),Object(a.jsxs)(O.g,{children:[Object(a.jsx)(O.d,{exact:!0,path:"/login",children:Object(a.jsx)($,{changeAuthStatus:function(e){s(e)},currentAuth:n})}),Object(a.jsx)(r,{exact:!0,path:"/",component:U})]})]})})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,240)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};i.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(H,{})}),document.getElementById("root")),K()}},[[230,1,2]]]);
//# sourceMappingURL=main.c18bd108.chunk.js.map