(this["webpackJsonpgss-teletravail-app"]=this["webpackJsonpgss-teletravail-app"]||[]).push([[0],{130:function(e,t,n){e.exports={navbar:"header_navbar__2Md7_",img:"header_img__1TnZd"}},133:function(e,t,n){e.exports={th:"HomeArray_th__1atYp"}},148:function(e,t,n){e.exports={td:"tickDay_td__vs5zh"}},149:function(e,t,n){e.exports={td:"userSchedule_td__3AU4d"}},155:function(e,t,n){e.exports={global:"global_global__1qDBh"}},163:function(e,t,n){},231:function(e,t,n){"use strict";n.r(t);var a=n(4),c=n(0),s=n.n(c),r=n(41),i=n.n(r),o=(n(163),n(35)),l=n(86),u=n(87),d=(n(164),n(117)),j=n(130),h=n.n(j),b=n.p+"static/media/logo.86b700a3.webp",m=function(e){return Object(a.jsxs)(l.a,{className:h.a.navbar,variant:"dark",expand:"lg",collapseOnSelect:!0,children:[Object(a.jsx)(d.LinkContainer,{to:"/",children:Object(a.jsx)(l.a.Brand,{children:Object(a.jsx)("img",{className:h.a.img,src:b,alt:"logo"})})}),Object(a.jsx)(l.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(a.jsx)(l.a.Collapse,{id:"responsive-navbar-nav",children:Object(a.jsxs)(u.a,{className:"ml-auto",children:[Object(a.jsx)(d.LinkContainer,{to:"/",children:Object(a.jsx)(u.a.Link,{className:"mx-3",children:"Mon service"})}),Object(a.jsx)(d.LinkContainer,{to:"/login",children:e.loginStatus?Object(a.jsx)(u.a.Link,{className:"mx-3",children:"Logout"}):Object(a.jsx)(u.a.Link,{className:"mx-3",children:"Login"})})]})})]})},O=n(60),f=n(13),x=n(30),g=n(84),p=n(151),v=n(54),y=n(17),k=n(145),C=n.n(k),w=n(156),N=(n(174),function(e){return Object(a.jsx)(C.a,{dateFormat:"MMMM yyyy",locale:w.a,selected:e.selected,onChange:function(t){e.handleChangeDate(t)},showMonthYearPicker:!0})}),S=n(83),A=n(95),D=n(96),E=n(157),I=n(150),L=n(148),_=n.n(L),F=function(e){return Object(a.jsx)("td",{className:_.a.td,onClick:function(){e.isClickable&&e.updateUser(e.user,e.selectedDate,e.indexJour,e.status)},style:function(){switch(e.status){case 0:return{background:"white"};case 1:return{background:"yellow"};case 2:return{background:"rgb(93,191,212"};case 3:return{background:"black"};default:return{background:"white"}}}()})},M=n(98),T=n(240),J=n(239),G=n(149),P=n.n(G),B=n(80),U=function(e){var t=function(e,t,n){var a=new Date(Date.UTC(t.indexOfYear,t.indexOfMonth,e+1));if(Object(J.a)(a))return 3;for(var c=0;c<n.length;c++)if(!Object(M.a)(a,Object(B.default)(n[c].date)))return n[c].status;return 0};return Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{className:P.a.td,children:[e.user.firstName," ",e.user.lastName]}),function(n,a){for(var s=[],r=n.nonWorkingDays,i=0;i<a.nbDays;i++)s.push(Object(c.createElement)(F,Object(x.a)(Object(x.a)({},e),{},{key:Object(T.a)(),indexJour:i,isClickable:3!==t(i,a,r)&&e.user.isActive,status:t(i,a,r)})));return s}(e.user,e.selectedDate)]})},W=n(133),q=n.n(W),Y=function(e){var t=Object(f.k)(),n=Object(c.useState)([]),s=Object(o.a)(n,2),r=s[0],i=s[1];Object(c.useEffect)((function(){if(e.currentAuth){fetch("/api/users/?department=GSS",{method:"GET",credentials:"include"}).then((function(e){return e.json()})).then((function(e){var t=e.userEmail,n=e.foundUsers;n.forEach((function(e){e.isActive=!1}));var a=n.findIndex((function(e){return t===e.email}));n[a].isActive=!0,n[a]=n.splice(0,1,n[a])[0],i(n)})).catch((function(e){console.log(e),t.push("/login")}))}}),[]);var l,u,d=function(e,n,a,c){var s=Object(E.a)(r),o=(c+1)%3,l=new Date(Date.UTC(n.indexOfYear,n.indexOfMonth,a+1)),u=r.findIndex((function(t){return t.email===e.email})),d=r[u].nonWorkingDays.findIndex((function(e){return 0===Object(M.a)(Object(B.default)(e.date),l)}));-1!==d?0!==o?s[u].nonWorkingDays[d]={date:l.toISOString(),status:o}:s[u].nonWorkingDays.splice(d,1):s[u].nonWorkingDays.push({date:l.toISOString(),status:o}),fetch("/api/users/"+s[u].email,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({nonWorkingDays:s[u].nonWorkingDays})}).then((function(e){if(401===e.status)throw new Error("Identification rejet\xe9e")})).then((function(){i((function(e){return s}))})).catch((function(e){t.push("/login"),console.log(e)}))};return Object(a.jsxs)(I.a,{bordered:!0,hover:!0,responsive:!0,size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:function(e){for(var t=[Object(a.jsx)("th",{className:q.a.th,children:"Jour du Mois"},Object(T.a)())],n=0;n<e;n++)t.push(Object(a.jsx)("th",{className:q.a.th,children:(n+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})},Object(T.a)()));return t}(e.selectedDate.nbDays)})}),Object(a.jsx)("tbody",{children:(l=r,u=e.selectedDate,l.map((function(e,t){return Object(a.jsx)(U,{user:e,selectedDate:u,updateUser:d},t)})))})]})},R=function(e){var t=Object(f.k)();Object(c.useEffect)((function(){e.currentAuth||t.push("/login")}),[]);var n=new Date,s=Object(c.useState)({indexOfMonth:Object(A.default)(n),indexOfYear:Object(D.default)(n),nbDays:Object(S.a)(n)}),r=Object(o.a)(s,2),i=r[0],l=r[1];return Object(a.jsxs)(g.a,{fluid:!0,className:"mt-5",children:[Object(a.jsx)(v.a,{className:"my-5",children:Object(a.jsx)(y.a,{children:Object(a.jsx)(N,{handleChangeDate:function(e){l({indexOfMonth:Object(A.default)(e),indexOfYear:Object(D.default)(e),nbDays:Object(S.a)(e)})},selected:new Date(Date.UTC(i.indexOfYear,i.indexOfMonth))},Object(T.a)())})}),Object(a.jsx)(v.a,{className:"my-5",children:Object(a.jsx)(y.a,{children:Object(a.jsx)(Y,{selectedDate:i,currentAuth:e.currentAuth},Object(T.a)())})}),Object(a.jsx)(v.a,{className:"my-5",children:Object(a.jsx)(y.a,{children:Object(a.jsx)(p.a,{fluid:!0,children:Object(a.jsx)(g.a,{children:Object(a.jsxs)(v.a,{children:[Object(a.jsx)(y.a,{md:!0,children:Object(a.jsxs)("h1",{children:[" ","Planning GSS"," ",new Date(i.indexOfYear,i.indexOfMonth).toLocaleDateString("fr-FR",{year:"numeric",month:"long"})]})}),Object(a.jsx)(y.a,{md:!0}),Object(a.jsx)(y.a,{md:!0,children:Object(a.jsx)("table",{children:Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour sur site"}),Object(c.createElement)(F,Object(x.a)(Object(x.a)({},e),{},{key:Object(T.a)(),indexJour:0,isClickable:!1,status:0}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour en t\xe9l\xe9travail"}),Object(c.createElement)(F,Object(x.a)(Object(x.a)({},e),{},{key:Object(T.a)(),indexJour:1,isClickable:!1,status:1}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Jour de cong\xe9"}),Object(c.createElement)(F,Object(x.a)(Object(x.a)({},e),{},{key:Object(T.a)(),indexJour:0,isClickable:!1,status:2}))]}),Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:"Week-end"}),Object(c.createElement)(F,Object(x.a)(Object(x.a)({},e),{},{key:Object(T.a)(),indexJour:0,isClickable:!1,status:3}))]})]})})})]})})})})})]})},z=n(9),V=n(106),Z=n(134),H=n(40);var $=function(e){var t=Object(c.useState)(!1),n=Object(o.a)(t,2),s=n[0],r=n[1],i=H.a({fName:H.c().when("$isRegistered",{is:!0,then:H.c().required("obligatoire")}),lName:H.c().when("$isRegistered",{is:!0,then:H.c().required("obligatoire")}),email:H.c().email("Entrez une adresse valide").required("Une adresse mail est requise"),password:H.c().required("Champs obligatoire").min(8,"Au moins 8 caract\xe8res").matches(/[a-z]/,"Au moins une minuscule").matches(/[A-Z]/,"Au moins une majuscule").matches(/[a-zA-Z]+[^a-zA-Z\s]+/,"Au moins un chiffre ou caract\xe8re sp\xe9cial"),passwordConfirm:H.c().oneOf([H.b("password"),null],"Les mots de passe doivent \xeatre identiques")}),l=function(){var e=Object(Z.b)().values;return""!==e.email&&fetch("/api/users/status/"+e.email).then((function(e){return e.json()})).then((function(e){void 0!==e&&r(e.userExist)}),(function(e){console.log(e)})),null};return Object(a.jsx)(g.a,{className:"my-5",children:Object(a.jsx)(Z.a,{validationSchema:i,onSubmit:function(t,n){s?function(t){return new Promise((function(n,a){fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t.email,password:t.password})}).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Mauvais mot de passe"))}))}))}(t).then((function(){n.setSubmitting(!1)})).catch((function(e){n.setFieldError("password",e.message),n.setSubmitting(!1)})):function(t){return new Promise((function(n,a){fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({firstName:t.fName,lastName:t.lName,email:t.email,department:"GSS",password:t.password,nonWorkingDays:[]})}).then((function(){e.changeAuthStatus(!0),n(!0)})).catch((function(e){a(new Error("Probl\xe8me lors de l'enregistrement du nouvel utilisateur"))}))}))}(t).then((function(){n.setSubmitting(!1)})).catch((function(e){alert(e.message),n.setSubmitting(!1)}))},initialValues:{fName:"",lName:"",email:"",password:"",passwordConfirm:""},children:function(e){var t=e.handleSubmit,n=e.handleChange,c=e.handleBlur,r=e.touched,i=e.values,o=e.isValid,u=e.errors;return Object(a.jsxs)(z.a,{noValidate:!0,onSubmit:t,children:[Object(a.jsxs)("h1",{className:"mt-5",children:["Bonjour ",i.fName," ",i.lName]}),Object(a.jsx)("p",{className:"my-3",children:i.email}),Object(a.jsx)(z.a.Row,{children:Object(a.jsxs)(z.a.Group,{as:y.a,controlId:"validationFormikUsermail",children:[Object(a.jsx)(z.a.Label,{children:"Adresse mail"}),Object(a.jsx)(z.a.Control,{type:"text",placeholder:"Adresse mail","aria-describedby":"Adresse mail",name:"email",value:i.email,onChange:n,onBlur:c,isInvalid:r.email&&u.email}),Object(a.jsx)(z.a.Control.Feedback,{type:"invalid",children:u.email})]})}),s?null:Object(a.jsxs)(z.a.Row,{children:[Object(a.jsxs)(z.a.Group,{as:y.a,md:"6",controlId:"validationFormikFname",children:[Object(a.jsx)(z.a.Label,{children:"Pr\xe9nom"}),Object(a.jsx)(z.a.Control,{type:"text",name:"fName",value:i.fName,onChange:n,onBlur:c,isInvalid:r.fName&&u.fName}),Object(a.jsx)(z.a.Control.Feedback,{type:"invalid",children:u.fName})]}),Object(a.jsxs)(z.a.Group,{as:y.a,md:"6",controlId:"validationFormikLname",children:[Object(a.jsx)(z.a.Label,{children:"Nom"}),Object(a.jsx)(z.a.Control,{type:"text",name:"lName",value:i.lName,onChange:n,onBlur:c,isInvalid:r.lName&&u.lName}),Object(a.jsx)(z.a.Control.Feedback,{type:"invalid",children:u.lName})]})]}),Object(a.jsxs)(z.a.Row,{children:[Object(a.jsxs)(z.a.Group,{as:y.a,md:"6",controlId:"validationFormikPassword",children:[Object(a.jsx)(z.a.Label,{children:"Mot de passe"}),Object(a.jsx)(z.a.Control,{type:"password",name:"password",value:i.password,onChange:n,onBlur:c,isInvalid:r.password&&u.password}),Object(a.jsx)(z.a.Control.Feedback,{type:"invalid",children:u.password})]}),s?null:Object(a.jsxs)(z.a.Group,{as:y.a,md:"6",controlId:"validationFormikPasswordConfirm",children:[Object(a.jsx)(z.a.Label,{children:"Confirmation du mot de passe"}),Object(a.jsx)(z.a.Control,{type:"password",name:"passwordConfirm",value:i.passwordConfirm,onChange:n,onBlur:c,isInvalid:r.passwordConfirm&&u.passwordConfirm}),Object(a.jsx)(z.a.Control.Feedback,{type:"invalid",children:u.passwordConfirm})]})]}),Object(a.jsx)(V.a,{type:"submit",variant:"primary",style:{backgroundColor:"rgb(36,42,117)"},disabled:!o,children:s?"Login":"Inscription"}),Object(a.jsx)(l,{})]})}})})};var K=function(e){var t=Object(c.useState)("Chargement..."),n=Object(o.a)(t,2),s=n[0],r=n[1];return Object(c.useEffect)((function(){fetch("/api/users/loggeduser",{method:"GET",credentials:"include"}).then((function(e){if(401===e.status)throw new Error("Identification rejet\xe9e");return e.json()})).then((function(e){r("Vous \xeates logg\xe9 comme "+e.firstName+" "+e.lastName+" ("+e.email+")")})).catch((function(t){console.log(t),e.changeAuthStatus(!1)}))}),[]),Object(a.jsxs)(g.a,{className:"my-5 ",children:[Object(a.jsx)(v.a,{children:Object(a.jsx)(y.a,{className:"mt-5",children:Object(a.jsx)("h1",{className:"my-5 text-center",children:s})})}),Object(a.jsx)(v.a,{children:Object(a.jsx)(y.a,{className:"text-center",children:Object(a.jsx)(V.a,{className:"my-5",variant:"primary",style:{backgroundColor:"rgb(36,42,117)"},onClick:function(t){fetch("/auth/logout",{method:"GET",credentials:"include"}).then((function(){e.changeAuthStatus(!1)})).catch((function(e){console.log("Erreur de requete serveur en faisant le logout")}))},children:"Logout"})})})]})};var Q=function(e){return Object(a.jsx)("div",{children:e.currentAuth?Object(a.jsx)(K,{changeAuthStatus:e.changeAuthStatus,currentAuth:e.currentAuth}):Object(a.jsx)($,{changeAuthStatus:e.changeAuthStatus,currentAuth:e.currentAuth})})},X=n(155),ee=n.n(X);var te=function(){var e=Object(c.useState)(!1),t=Object(o.a)(e,2),n=t[0],s=t[1],r=function(e){s(e)};return Object(c.useEffect)((function(){fetch("/auth/check",{method:"GET",credentials:"include"}).then((function(e){if(401===e.status)throw new Error("Identification rejet\xe9e");s(!0)})).catch((function(e){console.log(e),s(!1)}))}),[]),Object(a.jsx)("div",{className:ee.a.global,children:Object(a.jsxs)(O.BrowserRouter,{children:[Object(a.jsx)(m,{loginStatus:n}),Object(a.jsxs)(f.g,{children:[Object(a.jsx)(f.d,{exact:!0,path:"/login",children:Object(a.jsx)(Q,{changeAuthStatus:r,currentAuth:n})}),Object(a.jsx)(f.d,{exact:!0,path:"/",children:Object(a.jsx)(R,{changeAuthStatus:r,currentAuth:n})})]})]})})},ne=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,241)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};i.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(te,{})}),document.getElementById("root")),ne()}},[[231,1,2]]]);
//# sourceMappingURL=main.8d68dc7e.chunk.js.map